<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Movimiento de paquetes</title>
    <meta name="description" content="Comenzamos">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>

    <script>
    AFRAME.registerComponent('clickeador', {
      init: function () {
        console.log('Dentro de CLICKEADOR');
        let packet = 'syn';

        this.el.addEventListener('click', () => {
          packet_el = document.getElementById(packet);
          packet_el.emit('muevete');

          if (packet == 'syn') {
            packet = 'ack';
          } else {
            packet = 'syn';
          }
          console.log('paquete activo = ' + packet);
        })
      }
    });

    AFRAME.registerComponent('movedor', {
      init: function () {
        console.log('Dentro de MOVEDOR');
        let el = this.el
        let data = this.data
        let dir = Object.values(data)

        this.el.addEventListener('muevete', () => {
            el.setAttribute('animation', 'property:position; to:data ; dur:3000; dir:alternate;');
            console.log('data = ' + Object.values(data));
            console.log('data.to = ' + data.to)
            console.log('dir = ' + dir)
          })
      }
    });
    </script>

  </head>

  <body>
    <a-scene background="color: #FAFAFA">
      <!-- Creamos entorno para nuestra escena -->
      <a-entity environment="preset: starry"></a-entity>
      <a-entity light="type: ambient; color: #FFF"></a-entity>

      <a-entity cursor="rayOrigin: mouse"></a-entity>

      <!-- Ordenador Cliente -->
      <a-gltf-model id = "Cliente"
        src="gaming_laptop/scene.gltf"
        position="-3 0.5 -4"
        scale="0.5 0.5 0.5"
        rotation="0 -90 0">
      </a-gltf-model>

      <!-- Ordenador Servidor -->
      <a-gltf-model id = "Servidor"
        src="gaming_laptop/scene.gltf"
        position="3 0.5 -4"
        scale="0.5 0.5 0.5"
        rotation="0 -90 0">
      </a-gltf-model>

      <script>
        var scene = document.querySelector('a-scene');
        var boton_accion = document.createElement('a-entity');
        // Paquetes a enviar
        var p_syn = document.createElement('a-entity');
        var p_ack = document.createElement('a-entity');

        boton_accion.setAttribute( 'geometry', {primitive: 'sphere'});
        boton_accion.setAttribute( 'id', 'boton_accion');
        boton_accion.setAttribute( 'scale', {x : 0.25 , y : 0.25 , z : 0.25});
        boton_accion.setAttribute('material', 'color', 'blue');
        boton_accion.setAttribute( 'position' , { x : -1.75 , y : 4 , z : -4 });

        p_syn.setAttribute( 'geometry', {primitive: 'box'});
        p_syn.setAttribute( 'id', 'syn');
        p_syn.setAttribute( 'scale', {x : 0.1 , y : 0.1 , z : 0.1});
        p_syn.setAttribute('material', 'color', 'yellow');
        p_syn.setAttribute( 'position' , { x : -1.75 , y : 1.85 , z : -4 });

        p_ack.setAttribute( 'geometry', {primitive: 'box'});
        p_ack.setAttribute( 'id', 'ack');
        p_ack.setAttribute( 'scale', {x : 0.1 , y : 0.1 , z : 0.1});
        p_ack.setAttribute('material', 'color', 'red');
        p_ack.setAttribute( 'position' , { x : 1.75 , y : 1.85 , z : -4 });


        // Agregamos los objetos a nuestra escena.
        scene.appendChild(boton_accion);
        scene.appendChild(p_syn);
        scene.appendChild(p_ack);

        // Ver objeto
        //console.log(scene.querySelector('#ack'));

        boton_accion.setAttribute('clickeador' , '');
        p_syn.setAttribute('movedor','to: 1.75 1.85 -4');
        p_ack.setAttribute('movedor','to: -1.75 1.85 -4');

      </script>
    </a-scene>
  </body>
</html>
