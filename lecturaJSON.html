<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Reading Json</title>
    <meta name="description" content="Start">
  </head>

  <body>
    <script type="text/javascript">
    const request = new XMLHttpRequest();
    const requestURL = '/http_ejemplo.json';

    request.open('GET', requestURL);
    request.responseType = 'text';
    request.send();

    request.onload = function() {
      const dataTXT = request.response; // We take the response string
      const data = JSON.parse(dataTXT); // We convert it to an object
      //console.log(data);

      // Return data as string
      //console.log(JSON.stringify(data);

      // We get keys from our dictionary
      let num_keys = Object.keys(data);
      //console.log(num_keys);

      let num_packets = num_keys.length
      console.log("Total number of packets = " + num_packets);

      //Array to store all addresses
      let eth_total = [];
      let eth_fin = [];
      let ip_total = [];
      let ip_fin = [];

      // Function to keep the unique addresses of the arrays
      Array.prototype.unique=function(a){
        return function(){return this.filter(a)}}(function(a,b,c){return c.indexOf(a,b+1)<0
      });

      // We go through the JSON file to get the addresses
      for (let i = 0; i < num_packets; i++) {

        for(key in data[i]._source){

          console.log("--------------------Paquete " + i + "------------------------");

          //----------<<<<< Ethernet Address >>>>>----------
          let acces1 = data[i]._source[key].eth
          //Destination Address
          let eth_dst = Object.values(acces1)[0]
          console.log("Ethernet Destination Address " + i + " => " + eth_dst);
          //Source Address
          let eth_src = Object.values(acces1)[2]
          console.log("Ethernet Source Address " + i + " => " + eth_src);

          // AÃ±adimos a nuestro array todas las direcciones que vamos encontrando
          eth_total.push(eth_dst)
          eth_total.push(eth_src)
          console.log("Ethernet TOTAL => " + eth_total);

          eth_fin = eth_total.unique();
          console.log("Ethernet UNICAS => " + eth_fin)

          let num_nodes_eth = eth_fin.length;
          console.log("Numero nodos finales Ethernet => " + num_nodes_eth)

          //----------<<<<< IP Address >>>>>----------
          let acces2 = data[i]._source[key].ip
          //Destination Address
          let ip_dst = Object.values(acces2)[14]
          console.log("Ip Address " + i + " => " + ip_dst);
          //Source Address
          let ip_src = Object.values(acces2)[13]
          console.log("Ip Source Address " + i + " => " + ip_src);

          ip_total.push(ip_dst)
          ip_total.push(ip_src)
          console.log("IP TOTAL => " + ip_total);

          ip_fin = ip_total.unique();
          console.log("IP UNICAS => " + ip_fin);;

          let num_nodes_ip = ip_fin.length;
          console.log("Numero nodos finales IP => " + num_nodes_ip)

          //---------- <<<<<TIME RELATIVE >>>>>----------
          let acces3 = data[i]._source[key].frame
          let time_relative = Object.values(acces3)[6]
          console.log("Time relative " + i + " => " + time_relative);
        }
      }
    }
    </script>
  </body>
</html>
